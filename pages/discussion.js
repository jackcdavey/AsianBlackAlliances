import React from "react";
import { NextPage } from "next";
import Head from "next/head";
import { createClient } from 'next-sanity'

import { Button, Paper } from '@mui/material';

import { useForm, ValidationError } from '@formspree/react';

import Layout from "../public/components/layout";
import Header from "../public/components/header";
import Footer from "../public/components/footer.js";

const client = createClient({
  projectId: 'hiagtp2f',
  dataset: 'production',
  apiVersion: '2022-10-03',
  useCdn: false,
});

const Discussion = ({footerContent, discussionPost, discussionQuestion}) => {
    return (
        <>
            <Head>
                <title>ABA: Discussion</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
                <link rel="stylesheet" href="https://use.typekit.net/hco7ora.css" />

            </Head>
            <Header />
            <Layout title='ABA: Discussion' description=' '>
                <div id='body'>

                    <h1>Discussion</h1>
                    <p style={{ textAlign: "center" }}>If you would like to share your own story, plese submit a comment below.</p>

                    {discussionQuestion.map((question) => (
                    <div id='form' style={{display: 'flex', flexDirection: 'column', alignItems: 'center'}}>
                    <Paper className='collapsed' style={{borderRadius: '25px'}}>
            <a href={'#' + question._id} className='collapsed-desc'>
              {/* Display the first item in mythsCuriosityHeader */}
                                    <h2 style={{marginBottom: '0'}}>{question.title}</h2>
                                    <h3 style={{marginTop: 0}}>{question.body}</h3>
            </a>
          </Paper>
          <div className='collapsed-form' id={question._id}>

            <form action="https://formspree.io/f/xknevqwl" method="POST">
                <div id="formWrap">
                    <div className="fieldWrap">
                        <input style={{marginRight: "2%"}} type="text" id="name" placeholder="Name" required name="submissionName" />
                        <input style={{marginLeft: "2%"}} type="email" id="email" placeholder="Email" name="email" required />
                        <input style={{display: 'none'}} type="questionNumer" id="questionNumber" name="questionNumber" value={question.title} />
                    </div>
                    <div className="fieldWrap">
                        <textarea id="message" rows="7" placeholder="Message" name="message" required />
                    </div>
                    <Button variant="contained" type="submit" style={{margin: '1rem'}}>Send</Button>
                </div>
                    </form>
                        </div>
                    </div>
                    ))}


                    {/* Display each discussion post in a Card below */}
                    <h1>Posts</h1>
                    {discussionPost.map((post) => (
                        <Paper className="discussionCard" style={{borderRadius: "25px", marginBottom: '2rem'}}>
                            <h2>{post?.title}</h2>
                            <h3>From: {" " + post?.name}</h3>
                            <p>{post?.body}</p>
                        </Paper>
                    ))}

                </div>
            </Layout>

            <Footer 
            link={
          footerContent[0]?.link
        } body={
          footerContent[0]?.body
        } />
        </>
    )
}


export async function getStaticProps() {
    const footerContent = await client.fetch(`*[_type == "footerContent"]  | order(order asc)`)
    const discussionPost = await client.fetch(`*[_type == "discussionPost"]  | order(order asc)`)
    const discussionQuestion = await client.fetch(`*[_type == "discussionQuestion"]  | order(order asc)`)
    return {
        props: {
            footerContent,
            discussionPost,
            discussionQuestion,
        },
    };
}

export default Discussion

import React from 'react'
// import type { NextPage } from 'next'
import Head from 'next/head'
import { useState } from 'react'

import { createClient } from 'next-sanity'

// import styles from '../styles/Home.module.css'
import Header from '../public/components/header'
import Footer from '../public/components/footer.js'
import Layout from '../public/components/layout'

import dynamic from 'next/dynamic'

import { Typography, Button, Paper, Box, FormControl, InputLabel, MenuItem, Select } from '@mui/material';



import Grid from '@mui/material/Grid';

import {
  Timeline,
  TimelineItem,
  TimelineDot,
  TimelineSeparator,
  TimelineConnector,
  TimelineContent,
  TimelineOppositeContent
} from '@mui/lab';

import CollaborationMap from '../public/components/collaborationMap.js'

const ReactTooltip = dynamic(() => import('react-tooltip'), { ssr: false });

// import Tooltip from '@mui/material/Tooltip'

// const ReactToolTip = dynamic(() => import('react-tooltip'), { ssr : false });


const client = createClient({
  projectId: 'hiagtp2f',
  dataset: 'production',
  apiVersion: '2022-10-03',
  useCdn: false,
});

const styles = {
  theRadius: {
    borderRadius: '25px',
  },
}


function HistoryOfCollaboration({ timelinePoint, footerContent, historyResources, collaborationTag, navbarItem }) {

  const [lang, setLang] = useState('en');


  const handleChange = (event) => {
        setLang(event.target.value);
        if (typeof window !== "undefined") {
            localStorage.setItem("langChoice", event.target.value);
            console.log("Set local language to: " + event.target.value);
        }
  };
  
  const checkLang = () => {
    if (typeof window !== "undefined") {
      var languageSelection = localStorage.getItem('langChoice') || 'en';
      if(languageSelection != lang)
        setLang(languageSelection);
      console.log("Stored language is " + languageSelection);
    }
  }

  checkLang();
    
  const [tooltipContent, setTooltipContent] = useState("");
  
  const timelinePointL = timelinePoint.filter((point) => point.language === lang).length > 0 ? timelinePoint.filter((point) => point.language === lang) : timelinePoint.filter((point) => point.language === 'en');

  const collaborationTagL = collaborationTag.filter((tag) => tag.language === lang).length > 0 ? collaborationTag.filter((tag) => tag.language === lang) : collaborationTag.filter((tag) => tag.language === 'en');


  const footerContentL = footerContent.filter((footerContent) => footerContent.language == lang).length > 0 ? footerContent.filter((footerContent) => footerContent.language == lang) : footerContent.filter((footerContent) => footerContent.language == 'en');
  
  const historyResourcesL = historyResources.filter((historyResources) => historyResources.language == lang).length > 0 ? historyResources.filter((historyResources) => historyResources.language == lang) : historyResources.filter((historyResources) => historyResources.language == 'en');

    const navbarItemTitles = navbarItem.filter((item) => item.language === lang).length > 0 ? navbarItem.filter((item) => item.language === lang).map((item) => item.title) : navbarItem.filter((item) => item.language === "en").map((item) => item.title)

  const navbarItemLinks = navbarItem.filter((item) => item.language === lang).length > 0 ? navbarItem.filter((item) => item.language === lang).map((item) => item.link) : navbarItem.filter((item) => item.language === "en").map((item) => item.link)

  // console.log("Navbar Item: " + navbarItem);


  return (
    <>
      <Head>  
        <title>ABA: Contact & Collaboration</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <link rel="stylesheet" href="https://use.typekit.net/hco7ora.css" />
        <link rel="stylesheet" href="https://use.typekit.net/hco7ora.css" />


      </Head>
      <div style={{
        position: 'fixed',
        right: '0',
        zIndex: '100',
        marginTop: '2rem',
        marginRight: '1.5rem',
      }}>
                <Box sx={{ width: 100 }}>
                    <FormControl fullWidth>
                        <InputLabel id="demo-simple-select-label" style={{color: 'rgb(86, 129, 39)'}} > 
                            {lang}
                        </InputLabel>
                        <Select
                            labelId="demo-simple-select-label"
                            id="demo-simple-select"
                            value={lang}
                            label="Language"
                            onChange={handleChange}
                            style={{color: 'rgb(86, 129, 39)'}}
                        >
                              <MenuItem value={'en'}>English</MenuItem>
                            <MenuItem value={'zh-tw'}>繁體中文</MenuItem>
                            <MenuItem value={'zh-cn'}>粵語</MenuItem>
                            <MenuItem value={'zh'}>簡體中文</MenuItem>
                            <MenuItem value={'ko'}>한국어</MenuItem>
                            <MenuItem value={'vi'}>Tiếng Việt</MenuItem>
                            <MenuItem value={'ja'}>日本語</MenuItem>
                             
                              


                        </Select>
                    </FormControl>
                </Box>
            </div>
      <Header titles={navbarItemTitles} links={navbarItemLinks} />
      <Layout title={'Contact & Collaboration'} description={' '}>
        <div id='body'>
          <h1 style={{ margin: 0 }}>{
            lang == 'en' && 'Contact & Collaboration' ||
            lang == 'zh-tw' && '聯繫與合作' ||
            lang == 'zh-cn' && '聯繫與合作' ||
            lang == 'zh' && '联系与合作' ||
            lang == 'ko' && '연락처 및 협업' ||
            lang == 'vi' && 'Liên hệ và hợp tác' ||
            lang == 'ja' && '連絡先とコラボレーション'
            }</h1>
          <span style={{width: '70%', textAlign: 'center'}}>
            <p>{
              lang == 'en' && 'In this interactive page, you will find historically significant Black-Asian interactions. Each event builds on each other to create continuous possibilities for a sustainable relationship.' ||
              lang == 'zh-tw' && '在這個互動式頁面上，您將找到歷史上重要的黑人與亞裔的互動。每個事件都建立在彼此之上，以創建可持續關係的連續可能性。' ||
              lang == 'zh-cn' && '喺呢個互動頁面中，你將搵到具有歷史意義嘅黑人與亞裔嘅互動。 每個歷史事件都相互依存，為可持續的關係創造持續的可能性。' ||
              lang == 'zh' && '在这个互动页面中，您将找到具有历史意义的黑人与亚裔的互动。 每个历史事件都相互依存，为可持续的关系创造持续的可能性。' ||
              lang == 'ko' && '이 대화형 페이지에서는 역사적으로 중요한 흑인-아시아인 상호 작용을 찾을 수 있습니다. 각 이벤트는 지속 가능한 관계를 위한 지속적인 가능성을 만들기 위해 서로를 기반으로 합니다.' ||
              lang == 'vi' && 'Trên trang tương tác này, bạn sẽ tìm thấy các tương tác Mỹ-Á Châu có ý nghĩa lịch sử. Mỗi sự kiện xây dựng lên nhau để tạo ra những khả năng liên tục cho mối quan hệ có thể duy trì.' ||
              lang == 'ja' && 'このインタラクティブページでは、歴史的に重要な黒人とアジアの相互関係を見つけることができます。各イベントは、持続可能な関係のための継続的な可能性を生み出すために互いに構築されています。'
                } </p>
          </span>
            <CollaborationMap setTooltipContent={setTooltipContent} />
          <ReactTooltip effect='solid' uuid='mytt' >{tooltipContent}</ReactTooltip>
          <h3 style={{ fontSize: '1rem', marginBottom: 0 }}>{
            lang == 'en' && 'Please click on either marker to see a timeline of events.' ||
            lang == 'zh-tw' && '請點擊任一標記以查看事件的時間表。' ||
            lang == 'zh-cn' && '請點擊任一標記以查看事件的時間表。' ||
            lang == 'zh' && '请点击任一标记以查看事件记录表。' ||
            lang == 'ko' && '두 마커 중 하나를 클릭하면 이벤트 타임라인을 볼 수 있습니다.' ||
            lang == 'vi' && 'Vui lòng nhấp vào bất kỳ điểm đánh dấu nào để xem một dòng thời gian các sự kiện.' ||
            lang == 'ja' && 'いずれかのマーカーをクリックして、イベントのタイムラインを表示してください。'
          
          } </h3>
          

          <div className='collapsed-content' id='asia'>
          {/* display all collaboration tags that have section = asia in a timeline */}
          <Timeline position="alternate">
              {collaborationTagL.map((tag) => (
                tag.section === 'asia' &&
              <TimelineItem key={collaborationTagL._id}>
                <TimelineOppositeContent>
                  <Typography variant="body2" color="text.secondary">
                    {tag.date}
                  </Typography>
                </TimelineOppositeContent>
                <TimelineSeparator>
                  <TimelineDot />
                  <TimelineConnector />
                </TimelineSeparator>
                <TimelineContent> 
                  <Paper elevation={3}  className="collabTag" sx={{borderRadius: '25px !important'}}>
                    <Typography variant="h2" component="span" fontSize='1.4rem' sx={{ textAlign: 'left' }}>
                      {tag.title}
                    </Typography>
                    <Typography>{tag.body}</Typography>
                    {/* display each link for this tag in a button */}
                    {tag.link.map((link) => (
                      <Button variant="contained" href={link} target="_blank" rel="noopener noreferrer" sx={{ m: 1, borderRadius: "25px", maxHeight: '25%' }}>
                        {/* if there is a link label display, otherwise "More Info" */}
                        {tag.linkLabel[tag.link.indexOf(link)] ? tag.linkLabel[tag.link.indexOf(link)] : "More Info"}
                      </Button>
                    ))}
                  </Paper>
                </TimelineContent>
              </TimelineItem>
            ))}
          </Timeline>
          </div>


          <div className='collapsed-content' id='northAmerica' style={{maxWidth: '80rem'}}>
          {/* display all collaboration tags that have section = northAmerica in a timeline */}
          <Timeline position="alternate">
              {collaborationTagL.map((tag) => (
                tag.section === 'northamerica' &&
              <TimelineItem key={collaborationTagL._id}>
                <TimelineOppositeContent>
                  <Typography variant="body2" color="text.secondary" style={{fontSize: '1.2rem'}}>
                    {tag.date}
                  </Typography>
                </TimelineOppositeContent>
                <TimelineSeparator>
                  <TimelineDot />
                  <TimelineConnector />
                </TimelineSeparator>
                <TimelineContent>
                  <Paper elevation={3} className="collabTag" sx={{borderRadius: '25px !important'}}>
                    <Typography variant="h2" component="span" fontSize='1.4rem' sx={{ textAlign: 'left' }}>
                      {tag.title}
                    </Typography>
                    <Typography>{tag.body}</Typography>
                    {/* display each link for this tag in a button */}
                    {tag.link.map((link) => (
                      <Button variant="contained" href={link} target="_blank" rel="noopener noreferrer" sx={{ m: 1, borderRadius: "25px", maxHeight: '25%' }}>
                        {/* if there is a link label display, otherwise "More Info" */}
                        {tag.linkLabel[tag.link.indexOf(link)] ? tag.linkLabel[tag.link.indexOf(link)] : "More Info"}
                        
                      </Button>
                    ))}
                  </Paper>
                </TimelineContent>
              </TimelineItem>
            ))}
          </Timeline>
          </div>


              
      

          {historyResourcesL?.map((historyResource) => (
            <div key={historyResource._id} style={{ margin: '2%', maxWidth: '80rem' }}>
              <h1 style={{ textAlign: 'center', width: "100%", paddingLeft: '5%' }}>{historyResource?.title}</h1>
              <div style={{textAlign: 'center', paddingLeft: '5%', paddingRight: '5%', alignItems: "center"}}> 
                {historyResource?.body}
              </div>
              {/* Display each link and linkLabel, display a button */}
              {/* Create a centered grid 2 columns wide, with repeating rows */}
              <Grid container style={{margin: 'auto', width: '100%', display: 'flex', justifyContent: 'center', alignItems: 'center', flexWrap: 'wrap'}}>
              
              {historyResource?.link && (
                historyResource?.link?.map((link) => (
                  <Button variant="contained" color="primary" className={"resource-button"} href={historyResource?.link[historyResource?.link.indexOf(link)]} target="_blank" rel="noopener noreferrer" style={{  width: '40%', margin: '2%', borderRadius: '25px' }} >
                    <div style={{textAlign: 'center' }}>
                    {/* Display the linkLabel if it exists, otherwise display "More Info" */}
                      {historyResource?.linkLabel && historyResource?.linkLabel[historyResource?.link.indexOf(link)] ? historyResource?.linkLabel[historyResource?.link.indexOf(link)] : "More Info"}
                    </div>
                  </Button>
                ))
                )}
              </Grid>
            </div>
          ))}
        </div>
        
        
        

      </Layout>

      <Footer
      link={
          footerContentL[0]?.link
        } body={
          footerContentL[0]?.body
        }/>
    </>
  )
}

export async function getStaticProps() {
  const timelinePoint = await client.fetch(`*[_type == "timelinePoint"] | order(order asc)`)
  const footerContent = await client.fetch(`*[_type == "footerContent"]  | order(order asc)`)
  const historyResources = await client.fetch(`*[_type == "historyResources" ]  | order(order asc)`)
  const collaborationTag = await client.fetch(`*[_type == "collaborationTag"]  | order(order asc)`)
  const navbarItem = await client.fetch(`*[_type == "navbarItem"]  | order(order asc)`)

  return {
    props: {
      timelinePoint,
      footerContent,
      historyResources,
      collaborationTag,
      navbarItem,
    },
    revalidate: 10,
  };
}

export default HistoryOfCollaboration
